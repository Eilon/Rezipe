@inject RecipeStore Recipes
@inject ShellNavigationManager NavigationManager
@using XF = Xamarin.Forms

<Shell OnNavigated="OnNavigated"
       OnNavigating="OnNavigating"
       FlyoutHeaderBehavior="FlyoutHeaderBehavior.CollapseOnScroll"
       FlyoutBackgroundColor="Color.DarkGray">
    <FlyoutHeader>
        <ContentView HeightRequest="200">
            <Grid BackgroundColor="Color.Gray">
                <GridCell>
                    <Image Aspect="Aspect.AspectFill"
                           Source="@(ImageSource.FromResource("Rezipe.images.flyout-background.png"))"
                           Opacity="0.6" />
                </GridCell>
                <GridCell>
                    <Label Text="Rezipe"
                           TextColor="Color.White"
                           FontSize="40"
                           FontAttributes="FontAttributes.Bold"
                           HorizontalTextAlignment="TextAlignment.Center"
                           VerticalTextAlignment="TextAlignment.Center" />
                </GridCell>
            </Grid>
        </ContentView>
    </FlyoutHeader>
    <ChildContent>
        <StyleSheet Resource="app-styles.css" Assembly="GetType().Assembly" />

        <FlyoutItem Route="recipes"
                    Title="Recipes"
                    FlyoutDisplayOptions="FlyoutDisplayOptions.AsMultipleItems">

            <ShellContent Route="all"
                          Title="All Recipes"
                          Icon="@(ImageSource.FromResource("Rezipe.images.all-recipes-icon.png"))">
                <AllRecipes />
            </ShellContent>

            <ShellContent @ref="favRecipesPage"
                          Route="favorites"
                          Title="Favorite Recipes"
                          Icon="@(ImageSource.FromResource("Rezipe.images.favorites-icon.png"))">
                <FavoriteRecipes />
            </ShellContent>

        </FlyoutItem>

        <ShellContent Route="about"
                      Title="About">
            <AboutPage />
        </ShellContent>

    </ChildContent>
</Shell>

@code
{
    Microsoft.MobileBlazorBindings.Elements.ShellContent favRecipesPage;

    void OnNavigated(ShellNavigatedEventArgs e)
    {
    }

    void OnNavigating(ShellNavigatingEventArgs e)
    {
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            Xamarin.Forms.Shell.Current.ItemTemplate = GetShellItemTemplate();

            // Set ShellItem to the container of the Favorite Recipes page
            Xamarin.Forms.Shell.Current.CurrentItem = favRecipesPage.NativeControl;

            // Set ShellContent within tabs to the actual Favorite Recipes page
            Xamarin.Forms.Shell.Current.CurrentItem.CurrentItem = favRecipesPage.NativeControl;
        }
    }
}
